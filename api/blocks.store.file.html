<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>blocks.store.file documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Blocks</span> <span class="project-version">2.0.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="store.html"><div class="inner"><span># Implementation Decisions</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>blocks</span></div></div></li><li class="depth-2 branch"><a href="blocks.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="blocks.meter.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>meter</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>store</span></div></div></li><li class="depth-3 branch"><a href="blocks.store.buffer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buffer</span></div></a></li><li class="depth-3 branch"><a href="blocks.store.cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>cache</span></div></a></li><li class="depth-3 branch current"><a href="blocks.store.file.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>file</span></div></a></li><li class="depth-3 branch"><a href="blocks.store.memory.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>memory</span></div></a></li><li class="depth-3"><a href="blocks.store.replica.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>replica</span></div></a></li><li class="depth-2"><a href="blocks.summary.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>summary</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="blocks.store.file.html#var-file-block-store"><div class="inner"><span>file-block-store</span></div></a></li><li class="depth-1"><a href="blocks.store.file.html#var-layout-version"><div class="inner"><span>layout-version</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">blocks.store.file</h1><div class="doc"><div class="markdown"><p>This store provides block storage backed by files in local directories. Each block is stored in a separate file. File block stores may be constructed using the <code>file://&lt;path-to-root-dir&gt;</code> URI form. Under the root directory, the store keeps a block files in a subdirectory, alongside some layout metadata and a directory.</p>
<pre><code>$ROOT/meta.properties
$ROOT/blocks/111497df/35011497df3588b5a3...
$ROOT/landing/block.123456789.tmp
</code></pre>
<p>In many filesystems, performance degrades as the number of files in a directory grows. In order to reduce this impact and make navigating the blocks more efficient, block files are stored in multiple subdirectories consisting of the first four bytes of the multihashes of the blocks stored in them. Within each directory, blocks are stored in files whose names consist of the rest of their digests.</p>
<p>In addition to the blocks, a <code>meta.properties</code> file at the root holds information about the current storage layout for future-proofing. This currently holds a single property, the layout version, which is always <code>"1"</code>.</p></div></div><div class="public anchor" id="var-file-block-store"><h3>file-block-store</h3><div class="usage"><code>(file-block-store root &amp; {:as opts})</code></div><div class="doc"><div class="markdown"><p>Creates a new local file-based block store.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/store/file.clj#L358">view source</a></div></div><div class="public anchor" id="var-layout-version"><h3>layout-version</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>The current supported storage layout version.</p></div></div><div class="src-link"><a href="https://github.com/greglook/blocks/blob/master/src/blocks/store/file.clj#L44">view source</a></div></div></div></body></html>